<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio KIVA</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f3e5f5; --text: #4a148c; --primary: #7b1fa2; --panel: rgba(255,255,255,0.8); }
        [data-theme="dark"] { --bg: #0f172a; --text: #e9d5ff; --primary: #c084fc; --panel: rgba(30,41,59,0.8); }
        
        body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; transition: background 0.3s; }
        .theme-btn { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; background:none; border:none; cursor:pointer; }
        
        .shelf { background: var(--panel); padding: 20px; border-radius: 20px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        .bottle { width: 40px; height: 60px; border: 3px solid #5c6bc0; background: #fff; position: relative; border-radius: 0 0 10px 10px; overflow: hidden; margin: 0 auto 5px; }
        .liq { position: absolute; bottom: 0; width: 100%; height: 60%; }
        .btn { background: none; border: none; cursor: pointer; opacity: 1; transition: transform 0.2s; color: var(--text); font-weight: bold;}
        .btn:hover { transform: scale(1.1); }
        .btn.dis { opacity: 0.5; pointer-events: none; }
        
        .flask { width: 120px; height: 120px; border: 4px solid var(--primary); border-radius: 50%; background: #fff; position: relative; overflow: hidden; margin: 30px auto; display: flex; align-items: center; justify-content: center; }
        .flink { position: absolute; bottom: 0; width: 100%; height: 0%; background: #eee; transition: all 0.5s; }
        
        .result { background: var(--panel); padding: 20px; border-radius: 15px; text-align: center; max-width: 400px; opacity: 0; transform: translateY(20px); transition: 0.5s; }
        .result.show { opacity: 1; transform: translateY(0); }
        
        .action { padding: 10px 20px; border-radius: 20px; border: none; cursor: pointer; margin: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <button id="themeToggle" class="theme-btn">ðŸŒ™</button>
    <h1>ðŸ§ª Laboratorio</h1>
    <p>Mezcla 2 valores.</p>
    
    <div class="shelf">
        <button class="btn" onclick="add('r','#e53935')"><div class="bottle"><div class="liq" style="background:#e53935"></div></div>CariÃ±o</button>
        <button class="btn" onclick="add('b','#1e88e5')"><div class="bottle"><div class="liq" style="background:#1e88e5"></div></div>Hablar</button>
        <button class="btn" onclick="add('y','#fdd835')"><div class="bottle"><div class="liq" style="background:#fdd835"></div></div>LÃ­mites</button>
        <button class="btn" onclick="add('g','#43a047')"><div class="bottle"><div class="liq" style="background:#43a047"></div></div>Confianza</button>
    </div>

    <div class="flask">
        <div class="flink" id="fl"></div>
        <div id="icon" style="position:absolute; font-size:3rem; z-index:2;"></div>
    </div>

    <div class="result" id="res">
        <h3 id="rt"></h3><p id="rd"></p>
    </div>

    <div>
        <button class="action" onclick="reset()">ðŸ”„ Nueva</button>
        <button class="action" onclick="window.location.href='index.html'">â¬… Salir</button>
    </div>

    <script>
        // Tema
        const tBtn = document.getElementById('themeToggle');
        if(localStorage.getItem('theme') === 'dark'){ document.body.setAttribute('data-theme','dark'); tBtn.textContent='â˜€ï¸'; }
        tBtn.addEventListener('click', ()=>{
            const isDark = document.body.getAttribute('data-theme')==='dark';
            document.body.setAttribute('data-theme', isDark ? '' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
            tBtn.textContent = isDark ? 'ðŸŒ™' : 'â˜€ï¸';
        });

        let sel = [];
        const recipes = {
            "br": {c:"#ab47bc", i:"ðŸ‘‚", t:"EmpatÃ­a", d:"Escuchar con cariÃ±o."},
            "by": {c:"#66bb6a", i:"ðŸ›¡ï¸", t:"Seguridad", d:"LÃ­mites hablados protegen."},
            "ry": {c:"#ffa726", i:"ðŸ¤", t:"Cuidado", d:"CariÃ±o es respetar lÃ­mites."},
            "bg": {c:"#00bcd4", i:"ðŸ™‹", t:"Pedir Ayuda", d:"Hablar con confianza."}
        };

        function add(id, col) {
            if(sel.length >= 2 || sel.includes(id)) return;
            sel.push(id);
            document.getElementById('fl').style.height = sel.length===1 ? '50%' : '100%';
            document.getElementById('fl').style.background = col;
            
            if(sel.length === 2) {
                document.querySelectorAll('.btn').forEach(b=>b.classList.add('dis'));
                setTimeout(mix, 800);
            }
        }

        function mix() {
            sel.sort();
            const key = sel.join('');
            const r = recipes[key];
            const res = document.getElementById('res');
            res.classList.add('show');
            if(r) {
                document.getElementById('fl').style.background = r.c;
                document.getElementById('icon').textContent = r.i;
                document.getElementById('rt').textContent = r.t;
                document.getElementById('rd').textContent = r.d;
            } else {
                document.getElementById('fl').style.background = "#5d4037";
                document.getElementById('rt').textContent = "???";
                document.getElementById('rd').textContent = "Prueba otra mezcla.";
            }
        }

        function reset() {
            sel = [];
            document.getElementById('fl').style.height = '0%';
            document.getElementById('icon').textContent = '';
            document.getElementById('res').classList.remove('show');
            document.querySelectorAll('.btn').forEach(b=>b.classList.remove('dis'));
        }
    </script>
</body>
</html>