<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sopa KIVA</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f3e5f5; --text: #4a148c; --primary: #7b1fa2; --card: #fff; --sel: #ffca28; }
        [data-theme="dark"] { --bg: #0f172a; --text: #e9d5ff; --primary: #c084fc; --card: #1e293b; --sel: #d97706; }
        
        body { font-family: 'Nunito'; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; touch-action: none; transition: background 0.3s; }
        .theme-btn { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; background:none; border:none; cursor:pointer; }
        
        .game { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 500px; display: flex; flex-direction: column; align-items: center; }
        
        .words { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .tag { background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 15px; font-size: 0.9rem; font-weight: bold; }
        .tag.found { background: #c8e6c9; text-decoration: line-through; color: #1b5e20; }
        
        .grid { display: grid; gap: 2px; background: var(--primary); padding: 4px; border-radius: 8px; }
        .cell { width: 32px; height: 32px; background: var(--card); display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; user-select: none; color: var(--text); }
        .cell.sel { background: var(--sel); color: #000; }
        .cell.found { background: #66bb6a; color: #fff; }
        
        .win { position: fixed; inset: 0; background: rgba(255,255,255,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; pointer-events: none; z-index: 20; }
        [data-theme="dark"] .win { background: rgba(15,23,42,0.95); }
        .win.show { opacity: 1; pointer-events: all; }
        
        .btn { padding: 10px 20px; border-radius: 20px; border: none; margin: 5px; cursor: pointer; font-weight: bold; }
        .btn-reset { background: var(--primary); color: #fff; }
    </style>
</head>
<body>
    <button id="themeToggle" class="theme-btn">üåô</button>
    <h1>üîç Sopa KIVA</h1>
    
    <div class="game">
        <div class="words" id="wList"></div>
        <div class="grid" id="grid"></div>
        <div style="margin-top:20px">
            <button class="btn btn-reset" onclick="init()">Revolver</button>
            <button class="btn" onclick="window.location.href='index.html'">Salir</button>
        </div>
    </div>

    <div class="win" id="win">
        <h1>¬°Ganaste!</h1>
        <button class="btn btn-reset" onclick="init()">Jugar de nuevo</button>
        <button class="btn" onclick="window.location.href='index.html'">Salir</button>
    </div>

    <script>
        // Tema
        const tBtn = document.getElementById('themeToggle');
        if(localStorage.getItem('theme') === 'dark'){ document.body.setAttribute('data-theme','dark'); tBtn.textContent='‚òÄÔ∏è'; }
        tBtn.addEventListener('click', ()=>{
            const isDark = document.body.getAttribute('data-theme')==='dark';
            document.body.setAttribute('data-theme', isDark ? '' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
            tBtn.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
        });

        const words = ["VALENTIA", "AYUDA", "NO", "KIVA", "AMOR", "PAZ"];
        const size = 9;
        let grid = [], found = 0;
        let isSel = false, start = null, current = [];

        function init() {
            document.getElementById('win').classList.remove('show');
            found = 0;
            const g = document.getElementById('grid'); g.innerHTML = '';
            g.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            document.getElementById('wList').innerHTML = words.map(w=>`<div class='tag' id='t-${w}'>${w}</div>`).join('');
            
            // L√≥gica simplificada de generaci√≥n (para el ejemplo)
            grid = Array(size).fill('').map(()=>Array(size).fill(''));
            words.forEach(w => place(w));
            fill();
            render();
        }

        function place(w) {
            let placed = false;
            while(!placed) {
                const d = Math.random()>.5; // Horiz or Vert
                const r = Math.floor(Math.random()*size);
                const c = Math.floor(Math.random()*size);
                if(can(w,r,c,d)) { doP(w,r,c,d); placed=true; }
            }
        }
        function can(w,r,c,d) {
            if(d && c+w.length>size) return false;
            if(!d && r+w.length>size) return false;
            for(let i=0; i<w.length; i++) {
                const cell = d ? grid[r][c+i] : grid[r+i][c];
                if(cell !== '' && cell !== w[i]) return false;
            }
            return true;
        }
        function doP(w,r,c,d) {
            for(let i=0; i<w.length; i++) d ? grid[r][c+i]=w[i] : grid[r+i][c]=w[i];
        }
        function fill() {
            const l = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for(let r=0; r<size; r++) for(let c=0; c<size; c++) if(grid[r][c]==='') grid[r][c]=l[Math.floor(Math.random()*l.length)];
        }
        function render() {
            const g = document.getElementById('grid');
            for(let r=0; r<size; r++) for(let c=0; c<size; c++) {
                const d = document.createElement('div'); d.className='cell'; d.textContent=grid[r][c];
                d.dataset.r=r; d.dataset.c=c;
                d.onmousedown = (e) => { isSel=true; start={r,c}; upd(e); };
                d.onmouseenter = upd;
                d.onmouseup = end;
                d.ontouchstart = (e) => { e.preventDefault(); isSel=true; start={r,c}; };
                d.ontouchend = end;
                g.appendChild(d);
            }
            document.body.onmouseup = () => { if(isSel) end(); };
        }

        function upd(e) { if(isSel) highlight(start, {r:parseInt(e.target.dataset.r), c:parseInt(e.target.dataset.c)}); }
        function highlight(s, e) {
            document.querySelectorAll('.cell.sel').forEach(x=>x.classList.remove('sel'));
            current = [];
            // L√≥gica simple de l√≠nea recta
            const dr = e.r - s.r, dc = e.c - s.c;
            if(dr===0 || dc===0 || Math.abs(dr)===Math.abs(dc)) {
                const steps = Math.max(Math.abs(dr), Math.abs(dc));
                const ir = dr===0?0:dr/Math.abs(dr), ic = dc===0?0:dc/Math.abs(dc);
                let cr=s.r, cc=s.c;
                for(let i=0; i<=steps; i++) {
                    const cell = document.querySelector(`.cell[data-r="${cr}"][data-c="${cc}"]`);
                    if(cell) { cell.classList.add('sel'); current.push(cell); }
                    cr+=ir; cc+=ic;
                }
            }
        }
        function end() {
            isSel = false;
            const w = current.map(c=>c.textContent).join('');
            const rw = w.split('').reverse().join('');
            if(words.includes(w) || words.includes(rw)) {
                const realW = words.includes(w) ? w : rw;
                if(!document.getElementById('t-'+realW).classList.contains('found')) {
                    document.getElementById('t-'+realW).classList.add('found');
                    current.forEach(c=>{c.classList.add('found'); c.classList.remove('sel')});
                    found++;
                    if(found===words.length) document.getElementById('win').classList.add('show');
                }
            }
            document.querySelectorAll('.cell.sel').forEach(x=>x.classList.remove('sel'));
        }
        init();
    </script>
</body>
</html>