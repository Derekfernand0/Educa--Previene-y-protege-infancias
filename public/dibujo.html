<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIVA: Mi Espacio Creativo</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #e0f7fa;
            --panel-color: #ffffff;
            --text-color: #37474f;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
            --btn-text: #fff;
        }

        /* --- MODO OSCURO --- */
        [data-theme="dark"] {
            --bg-color: #0f172a;
            --panel-color: #1e293b;
            --text-color: #e2e8f0;
            --shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(rgba(0,0,0,0.1) 10%, transparent 11%);
            background-size: 20px 20px;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }

        header { text-align: center; padding: 20px; width: 100%; }
        h1 { font-family: 'Fredoka', sans-serif; color: #0277bd; margin: 0; font-size: 2rem; }
        [data-theme="dark"] h1 { color: #38bdf8; }
        p.subtitle { margin: 5px 0 0; font-size: 1.1rem; opacity: 0.8; }

        .theme-btn {
            position: absolute; top: 20px; right: 20px;
            background: var(--panel-color); border: none; font-size: 1.5rem;
            cursor: pointer; padding: 10px; border-radius: 50%;
            box-shadow: var(--shadow); transition: transform 0.2s;
        }
        .theme-btn:hover { transform: scale(1.1); }

        .game-container { display: flex; flex-wrap: wrap; gap: 20px; max-width: 1200px; width: 95%; justify-content: center; }
        
        .tools-panel, .prompt-panel {
            background: var(--panel-color); padding: 20px; border-radius: 20px;
            box-shadow: var(--shadow); flex: 1; min-width: 200px; display: flex; flex-direction: column; gap: 15px;
        }

        .colors-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .color-btn { width: 35px; height: 35px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; transition: transform 0.2s; }
        .color-btn.active { border-color: var(--text-color); transform: scale(1.1); }

        .action-btn {
            background: #4fc3f7; border: none; padding: 10px; border-radius: 12px;
            color: white; font-family: 'Fredoka', sans-serif; cursor: pointer;
            font-size: 1rem; margin-top: 5px;
        }
        .action-btn:hover { filter: brightness(0.9); }
        .action-btn.delete { background: #ef5350; }
        .action-btn.save { background: #66bb6a; }
        .action-btn.back { background: #ffa726; margin-top: auto; }

        .canvas-wrapper {
            background: white; border-radius: 20px; box-shadow: var(--shadow);
            border: 4px solid var(--panel-color); overflow: hidden; width: 600px; height: 500px;
            cursor: crosshair;
        }
        
        /* Ajuste responsivo */
        @media (max-width: 900px) { .canvas-wrapper { width: 100%; height: 400px; } }

        .prompt-card { background: rgba(0,0,0,0.05); padding: 15px; border-radius: 15px; margin-top: 15px; text-align: center; }
        .prompt-emoji { font-size: 3rem; display: block; }
        .prompt-text { font-weight: bold; margin-top: 5px; color: #f57f17; }
        [data-theme="dark"] .prompt-text { color: #facc15; }
    </style>
</head>
<body>
    <button id="themeToggle" class="theme-btn">üåô</button>

    <header>
        <h1>üé® KIVA Art</h1>
        <p class="subtitle">Expresa lo que sientes, tu voz importa.</p>
    </header>

    <div class="game-container">
        <aside class="tools-panel">
            <div class="colors-grid">
                <div class="color-btn active" style="background:#000" data-color="#000"></div>
                <div class="color-btn" style="background:#ef5350" data-color="#ef5350"></div>
                <div class="color-btn" style="background:#ab47bc" data-color="#ab47bc"></div>
                <div class="color-btn" style="background:#5c6bc0" data-color="#5c6bc0"></div>
                <div class="color-btn" style="background:#42a5f5" data-color="#42a5f5"></div>
                <div class="color-btn" style="background:#26c6da" data-color="#26c6da"></div>
                <div class="color-btn" style="background:#66bb6a" data-color="#66bb6a"></div>
                <div class="color-btn" style="background:#d4e157" data-color="#d4e157"></div>
                <div class="color-btn" style="background:#ffca28" data-color="#ffca28"></div>
                <div class="color-btn" style="background:#ffa726" data-color="#ffa726"></div>
                <div class="color-btn" style="background:#8d6e63" data-color="#8d6e63"></div>
                <div class="color-btn" style="background:#fff; border:1px solid #ccc" data-color="#fff"></div>
            </div>
            <input type="range" id="brushSize" min="1" max="30" value="5">
            <button class="action-btn" id="btnEraser">üßº Borrador</button>
            <button class="action-btn" id="btnBrush">üñåÔ∏è Pincel</button>
            <button class="action-btn delete" id="btnClear">üóëÔ∏è Limpiar</button>
            <button class="action-btn save" id="btnSave">üíæ Guardar</button>
            <button class="action-btn back" onclick="window.location.href='index.html'">‚¨Ö Salir</button>
        </aside>

        <div class="canvas-wrapper" id="canvasContainer">
            <canvas id="drawingCanvas"></canvas>
        </div>

        <aside class="prompt-panel">
            <h3>‚ú® Inspiraci√≥n</h3>
            <div class="prompt-card" id="promptCard">
                <span class="prompt-emoji">üè†</span>
                <div class="prompt-text">Mi Lugar Seguro</div>
                <div style="font-size:0.9rem; margin-top:5px;">Dibuja donde te sientes protegido/a.</div>
            </div>
            <button class="action-btn" onclick="newPrompt()" style="background:transparent; color:var(--text-color); border:2px solid var(--text-color);">üîÑ Nueva idea</button>
        </aside>
    </div>

    <script>
        // --- MODO OSCURO ---
        const tBtn = document.getElementById('themeToggle');
        // Leer localStorage al inicio
        if(localStorage.getItem('theme') === 'dark'){
            document.body.setAttribute('data-theme', 'dark');
            tBtn.textContent = '‚òÄÔ∏è';
        }
        tBtn.addEventListener('click', () => {
            if(document.body.getAttribute('data-theme') === 'dark'){
                document.body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                tBtn.textContent = 'üåô';
            } else {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                tBtn.textContent = '‚òÄÔ∏è';
            }
        });

        // --- L√ìGICA DE DIBUJO ---
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvasContainer');
        let isDrawing = false, lastX = 0, lastY = 0, brushColor = '#000', brushSize = 5, isEraser = false;

        function resizeCanvas() {
            canvas.width = container.offsetWidth; canvas.height = container.offsetHeight;
            ctx.lineCap = 'round'; ctx.lineJoin = 'round';
            ctx.fillStyle = "#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }
        function start(e) { isDrawing = true; const pos = getPos(e); lastX = pos.x; lastY = pos.y; }
        function stop() { isDrawing = false; }
        function draw(e) {
            if (!isDrawing) return;
            if (e.cancelable) e.preventDefault();
            const pos = getPos(e);
            ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(pos.x, pos.y);
            ctx.strokeStyle = isEraser ? '#fff' : brushColor; ctx.lineWidth = brushSize;
            ctx.stroke(); lastX = pos.x; lastY = pos.y;
        }

        canvas.addEventListener('mousedown', start); canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stop); canvas.addEventListener('mouseout', stop);
        canvas.addEventListener('touchstart', start); canvas.addEventListener('touchmove', draw); canvas.addEventListener('touchend', stop);

        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active'); brushColor = btn.getAttribute('data-color'); isEraser = false;
            });
        });
        document.getElementById('brushSize').addEventListener('input', (e) => brushSize = e.target.value);
        document.getElementById('btnEraser').addEventListener('click', () => isEraser = true);
        document.getElementById('btnBrush').addEventListener('click', () => isEraser = false);
        document.getElementById('btnClear').addEventListener('click', () => {
            if(confirm('¬øBorrar?')) { ctx.fillStyle = "#fff"; ctx.fillRect(0,0,canvas.width,canvas.height); }
        });
        document.getElementById('btnSave').addEventListener('click', () => {
            const l = document.createElement('a'); l.download = 'kiva-dibujo.png'; l.href = canvas.toDataURL(); l.click();
        });

        const prompts = [
            {e:"üè†",t:"Mi Lugar Seguro"}, {e:"üõ°Ô∏è",t:"Mi Escudo"}, {e:"üë®‚Äçüë©‚Äçüëß",t:"Mi Red de Apoyo"},
            {e:"üòä",t:"Alegr√≠a"}, {e:"üö¶",t:"Sem√°foro Corporal"}, {e:"ü¶∏",t:"Yo Superh√©roe"}
        ];
        function newPrompt() {
            const p = prompts[Math.floor(Math.random() * prompts.length)];
            const c = document.getElementById('promptCard');
            c.style.opacity = 0;
            setTimeout(() => {
                c.innerHTML = `<span class="prompt-emoji">${p.e}</span><div class="prompt-text">${p.t}</div>`;
                c.style.opacity = 1;
            }, 300);
        }
    </script>
</body>
</html>